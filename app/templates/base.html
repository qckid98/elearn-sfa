<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Fashion School System{% endblock %}</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Bootstrap (minimal usage) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Custom Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />

  {% block extra_css %}{% endblock %}
</head>

<body>
  {% with messages = get_flashed_messages() %}
  {% if messages %}
  <div class="toast-wrapper">
    {% for message in messages %}
    <div class="alert alert-info">
      <i class="fas fa-info-circle"></i>
      <span>{{ message }}</span>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}

  {% if current_user.is_authenticated %}
  <!-- App Layout with Sidebar -->
  <div class="app-wrapper">
    <!-- Sidebar Overlay (Mobile) -->
    <div class="sidebar-overlay"></div>

    <!-- Sidebar -->
    <aside class="sidebar">
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <i class="fas fa-cut"></i>
        </div>
        <div class="sidebar-brand">
          <span class="sidebar-brand-name">FASHION<span style="opacity: 0.7">SCHOOL</span></span>
          <span class="sidebar-brand-tagline">Academic System</span>
        </div>
        <button class="sidebar-toggle" title="Toggle Sidebar">
          <i class="fas fa-chevron-left"></i>
        </button>
      </div>

      <!-- Sidebar Navigation -->
      <nav class="sidebar-nav">
        <!-- Main Menu -->
        <div class="nav-section">
          <a href="{{ url_for('main.dashboard') }}"
            class="nav-item {% if request.endpoint == 'main.dashboard' %}active{% endif %}">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
        </div>

        {% if current_user.role == 'admin' %}
        <!-- Admin Menu -->
        <div class="nav-section">
          <div class="nav-section-title">Manajemen</div>
          <a href="{{ url_for('main.admin_invite') }}"
            class="nav-item {% if request.endpoint == 'main.admin_invite' %}active{% endif %}">
            <i class="fas fa-user-plus"></i>
            <span>Invite Siswa</span>
          </a>
          <a href="{{ url_for('admin.student_list') }}"
            class="nav-item {% if 'student' in request.endpoint %}active{% endif %}">
            <i class="fas fa-users"></i>
            <span>Data Siswa</span>
          </a>
          <a href="{{ url_for('admin.teacher_list') }}"
            class="nav-item {% if 'teacher' in request.endpoint %}active{% endif %}">
            <i class="fas fa-chalkboard-teacher"></i>
            <span>Pengajar</span>
          </a>
          <a href="{{ url_for('admin.program_manage') }}"
            class="nav-item {% if 'program' in request.endpoint %}active{% endif %}">
            <i class="fas fa-book-open"></i>
            <span>Program</span>
          </a>
          <a href="{{ url_for('admin.master_schedule') }}"
            class="nav-item {% if 'schedule' in request.endpoint %}active{% endif %}">
            <i class="fas fa-calendar-alt"></i>
            <span>Master Schedule</span>
          </a>
        </div>

        {% elif current_user.role == 'teacher' %}
        <!-- Teacher Menu -->
        <div class="nav-section">
          <div class="nav-section-title">Absensi</div>
          <a href="{{ url_for('attendance.view_form', timeslot_id=1) }}" class="nav-item">
            <i class="fas fa-sun"></i>
            <span>Sesi 1 (Pagi)</span>
          </a>
          <a href="{{ url_for('attendance.view_form', timeslot_id=2) }}" class="nav-item">
            <i class="fas fa-moon"></i>
            <span>Sesi 2 (Siang)</span>
          </a>
        </div>

        {% else %}
        <!-- Student Menu -->
        <div class="nav-section">
          <div class="nav-section-title">Akademik</div>
          <a href="{{ url_for('onboarding.schedule_wizard') }}" class="nav-item">
            <i class="fas fa-calendar-check"></i>
            <span>Atur Jadwal</span>
          </a>
        </div>
        {% endif %}
      </nav>

      <!-- Sidebar Footer -->
      <div class="sidebar-footer">
        <div class="sidebar-user">
          <div class="sidebar-user-avatar">
            {{ current_user.name[0]|upper if current_user.name else '?' }}
          </div>
          <div class="sidebar-user-info">
            <div class="sidebar-user-name">{{ current_user.name if current_user.name else 'User' }}</div>
            <div class="sidebar-user-role">{{ current_user.role|capitalize }}</div>
          </div>
          <a href="{{ url_for('auth.logout') }}" class="sidebar-user-logout" title="Logout">
            <i class="fas fa-sign-out-alt"></i>
          </a>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Header -->
      <header class="top-header">
        <div class="header-left">
          <button class="btn btn-icon mobile-toggle">
            <i class="fas fa-bars"></i>
          </button>

          <!-- Server Time Clock -->
          <div class="d-none d-sm-flex align-items-center gap-2 text-muted fw-600 ms-3" style="font-size: 14px;">
            <i class="fas fa-clock text-brand-primary"></i>
            <span id="serverClock">{{ now.strftime('%H:%M:%S') }}</span> WIB
          </div>

          <h1 class="page-title ms-4">{% block page_title %}Dashboard{% endblock %}</h1>
        </div>
        <div class="header-right">
          <button class="header-icon-btn" title="Tema">
            <i class="fas fa-moon"></i>
          </button>
          <button class="header-icon-btn" title="Notifikasi">
            <i class="fas fa-bell"></i>
          </button>
          <div class="dropdown">
            <div class="header-user" data-dropdown-toggle>
              <div class="header-user-info">
                <div class="header-user-name">{{ current_user.name if current_user.name else 'User' }}</div>
                <div class="header-user-date">{{ now.strftime('%d %b %Y') }}</div>
              </div>
            </div>
            <div class="dropdown-menu">
              <div class="dropdown-item">
                <i class="fas fa-user"></i>
                <span>Profil Saya</span>
              </div>
              <div class="dropdown-item">
                <i class="fas fa-cog"></i>
                <span>Pengaturan</span>
              </div>
              <div class="dropdown-divider"></div>
              <a href="{{ url_for('auth.logout') }}" class="dropdown-item danger">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Content Body -->
      <div class="content-body">
        {% block content %}{% endblock %}
      </div>
    </main>
  </div>

  {% else %}
  <!-- Guest Layout (Login, etc.) -->
  <div class="guest-wrapper">
    {% block guest_content %}{% endblock %}
  </div>
  {% endif %}

  <!-- Core JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>

  <script>
    // Server Clock Script
    // Initialize with server time via Jinja
    let serverTime = new Date("{{ now.strftime('%Y-%m-%dT%H:%M:%S') }}");

    function updateClock() {
      serverTime.setSeconds(serverTime.getSeconds() + 1);

      const hours = String(serverTime.getHours()).padStart(2, '0');
      const minutes = String(serverTime.getMinutes()).padStart(2, '0');
      const seconds = String(serverTime.getSeconds()).padStart(2, '0');

      const clockEl = document.getElementById('serverClock');
      if (clockEl) {
        clockEl.textContent = `${hours}:${minutes}:${seconds}`;
      }
    }

    setInterval(updateClock, 1000);
  </script>

  {% block extra_js %}{% endblock %}
</body>

</html>