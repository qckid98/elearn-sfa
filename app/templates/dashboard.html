{% extends "base.html" %} {% block content %}

<div class="row mb-5 align-items-end">
  <div class="col-md-8">
    <p class="text-uppercase text-danger fw-bold mb-1 ls-1 small">Dashboard</p>
    <h2 class="fw-bold display-6">Halo, {{ current_user.name }}</h2>
    <p class="text-muted mb-0">
      Role:
      <span class="badge bg-soft-dark text-dark"
        >{{ current_user.role|capitalize }}</span
      >
    </p>
  </div>
  <div class="col-md-4 text-md-end mt-3 mt-md-0">
    <div class="text-muted small">{{ now_date }}</div>
  </div>
</div>

<div class="row g-4">
  {% if current_user.role == 'admin' %}

  <div class="col-12 mb-2"><h5 class="fw-bold">Menu Utama</h5></div>

  <div class="col-6 col-md-4 col-lg-3">
    <div class="card h-100 hover-card text-center py-4">
      <div class="card-body">
        <div class="icon-box bg-soft-danger mx-auto">
          <i class="fas fa-user-plus"></i>
        </div>
        <h6 class="fw-bold">Invite Siswa</h6>
        <p class="small text-muted mb-0">Daftarkan siswa baru</p>
        <a href="{{ url_for('main.admin_invite') }}" class="stretched-link"></a>
      </div>
    </div>
  </div>

  <div class="col-6 col-md-4 col-lg-3">
    <div class="card h-100 hover-card text-center py-4">
      <div class="card-body">
        <div class="icon-box bg-soft-danger mx-auto">
          <i class="fas fa-users"></i>
        </div>
        <h6 class="fw-bold">Data Siswa</h6>
        <p class="small text-muted mb-0">Lihat database siswa</p>
        <a
          href="{{ url_for('admin.student_list') }}"
          class="stretched-link"
        ></a>
      </div>
    </div>
  </div>

  <div class="col-6 col-md-4 col-lg-3">
    <div class="card h-100 hover-card text-center py-4">
      <div class="card-body">
        <div class="icon-box bg-soft-warning mx-auto">
          <i class="fas fa-chalkboard-teacher"></i>
        </div>
        <h6 class="fw-bold">Pengajar</h6>
        <p class="small text-muted mb-0">Kelola guru & skill</p>
        <a
          href="{{ url_for('admin.teacher_list') }}"
          class="stretched-link"
        ></a>
      </div>
    </div>
  </div>

  <div class="col-6 col-md-4 col-lg-3">
    <div class="card h-100 hover-card text-center py-4">
      <div class="card-body">
        <div class="icon-box bg-soft-warning mx-auto">
          <i class="fas fa-book-open"></i>
        </div>
        <h6 class="fw-bold">Program</h6>
        <p class="small text-muted mb-0">Kurikulum & Sesi</p>
        <a
          href="{{ url_for('admin.program_manage') }}"
          class="stretched-link"
        ></a>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-8 col-lg-6">
    <div
      class="card h-100 hover-card bg-dark text-white"
      style="background: linear-gradient(45deg, #212529, #343a40)"
    >
      <div
        class="card-body d-flex align-items-center justify-content-between p-4"
      >
        <div>
          <h5 class="fw-bold text-white">Master Schedule</h5>
          <p class="text-white-50 mb-0">
            Monitoring kepadatan kelas secara real-time.
          </p>
        </div>
        <div class="icon-box bg-white text-dark mb-0">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <a
          href="{{ url_for('admin.master_schedule') }}"
          class="stretched-link"
        ></a>
      </div>
    </div>
  </div>

  {% elif current_user.role == 'teacher' %}

  <div class="col-12">
    <div class="alert alert-light border shadow-sm">
      ðŸ‘‹ Selamat mengajar, jangan lupa absen ya!
    </div>
  </div>

  <div class="col-md-6">
    <div class="card h-100 hover-card border-start border-warning border-5">
      <div class="card-body p-4 d-flex align-items-center">
        <div class="icon-box bg-soft-warning mb-0 me-3">
          <i class="fas fa-sun"></i>
        </div>
        <div>
          <h5 class="fw-bold mb-1">Absensi Sesi 1</h5>
          <p class="text-muted small mb-0">Jam 10:00 - 13:00</p>
        </div>
        <a
          href="{{ url_for('attendance.view_form', timeslot_id=1) }}"
          class="stretched-link"
        ></a>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card h-100 hover-card border-start border-dark border-5">
      <div class="card-body p-4 d-flex align-items-center">
        <div class="icon-box bg-soft-dark mb-0 me-3">
          <i class="fas fa-moon"></i>
        </div>
        <div>
          <h5 class="fw-bold mb-1">Absensi Sesi 2</h5>
          <p class="text-muted small mb-0">Jam 14:00 - 17:00</p>
        </div>
        <a
          href="{{ url_for('attendance.view_form', timeslot_id=2) }}"
          class="stretched-link"
        ></a>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </div>
    </div>
  </div>

  {% elif enrollment %}

  <div class="col-md-4">
    <div
      class="card h-100 bg-danger text-white shadow-lg overflow-hidden position-relative"
    >
      <div
        style="
          position: absolute;
          top: -20px;
          right: -20px;
          width: 100px;
          height: 100px;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 50%;
        "
      ></div>

      <div
        class="card-body text-center d-flex flex-column justify-content-center p-4"
      >
        <p class="text-white-50 text-uppercase small ls-1 mb-2">
          Sisa Sesi Anda
        </p>
        <h1 class="display-1 fw-bold mb-0">
          {{ enrollment.sessions_remaining }}
        </h1>
        <p class="mt-2 mb-0 fw-bold">{{ enrollment.program.name }}</p>
        {% if enrollment.batch %}
        <span class="badge bg-white text-danger mt-2 mx-auto"
          >{{ enrollment.batch.name }}</span
        >
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-8">
    <div class="card h-100">
      <div
        class="card-header bg-white py-3 d-flex justify-content-between align-items-center"
      >
        <h6 class="fw-bold mb-0">
          <i class="fas fa-calendar-week text-danger me-2"></i> Jadwal Rutin
        </h6>
        {% if not enrollment.schedules %}
        <a
          href="{{ url_for('onboarding.schedule_wizard') }}"
          class="btn btn-sm btn-danger rounded-pill"
          >Atur Jadwal</a
        >
        {% endif %}
      </div>
      <div class="card-body p-0">
        {% if enrollment.schedules %}
        <div class="table-responsive">
          <table class="table table-custom table-hover mb-0">
            <thead>
              <tr>
                <th class="ps-4">Hari</th>
                <th>Waktu</th>
                <th>Materi</th>
                <th>Pengajar</th>
              </tr>
            </thead>
            <tbody>
              {% for sched in enrollment.schedules %}
              <tr>
                <td class="ps-4">
                  <span
                    class="badge bg-light text-dark border fw-normal px-3 py-2"
                    >{{ days[sched.day_of_week] }}</span
                  >
                </td>
                <td class="fw-bold text-danger">{{ sched.timeslot.name }}</td>
                <td>{{ sched.subject.name }}</td>
                <td>
                  <div class="d-flex align-items-center">
                    <div
                      class="bg-light rounded-circle text-center me-2"
                      style="width: 30px; height: 30px; line-height: 30px"
                    >
                      <i class="fas fa-user-tie small text-muted"></i>
                    </div>
                    {{ sched.teacher.name.split(' ')[0] }}
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-5">
          <img
            src="https://cdn-icons-png.flaticon.com/512/7486/7486831.png"
            alt="No Schedule"
            style="width: 80px; opacity: 0.5"
            class="mb-3"
          />
          <p class="text-muted">Anda belum memiliki jadwal rutin.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  {% else %}
  <div class="col-12">
    <div class="alert alert-warning border-0 shadow-sm rounded-3">
      <i class="fas fa-exclamation-triangle me-2"></i> Akun ini terdaftar
      sebagai Siswa tetapi belum memiliki data Enrollment. Hubungi Admin.
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
