{% extends "base.html" %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Dashboard Content -->
<div class="dashboard-container">

  {% if current_user.role == 'admin' %}
  <!-- ==================== ADMIN DASHBOARD ==================== -->

  <!-- Greeting Section -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="fw-700 mb-1">Selamat Datang, {{ current_user.name }}! ðŸ‘‹</h2>
      <p class="text-muted mb-0">Kelola sistem akademik Fashion School dari sini.</p>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row g-4 mb-4">
    <div class="col-6 col-md-3">
      <div class="stats-card">
        <div class="stats-card-icon primary">
          <i class="fas fa-users"></i>
        </div>
        <div class="stats-card-value">{{ stats.total_students if stats else '0' }}</div>
        <div class="stats-card-label">Total Siswa</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stats-card">
        <div class="stats-card-icon success">
          <i class="fas fa-chalkboard-teacher"></i>
        </div>
        <div class="stats-card-value">{{ stats.total_teachers if stats else '0' }}</div>
        <div class="stats-card-label">Total Pengajar</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stats-card">
        <div class="stats-card-icon warning">
          <i class="fas fa-book-open"></i>
        </div>
        <div class="stats-card-value">{{ stats.total_programs if stats else '0' }}</div>
        <div class="stats-card-label">Program Aktif</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stats-card">
        <div class="stats-card-icon info">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="stats-card-value">{{ stats.total_sessions if stats else '0' }}</div>
        <div class="stats-card-label">Sesi Hari Ini</div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row g-4 mb-4">
    <div class="col-12">
      <h5 class="fw-600 mb-3">Menu Cepat</h5>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <a href="{{ url_for('main.admin_invite') }}" class="action-card">
        <div class="action-card-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <div class="action-card-content">
          <div class="action-card-title">Invite Siswa</div>
          <div class="action-card-desc">Daftarkan siswa baru</div>
        </div>
      </a>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <a href="{{ url_for('admin.student_list') }}" class="action-card">
        <div class="action-card-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="action-card-content">
          <div class="action-card-title">Data Siswa</div>
          <div class="action-card-desc">Lihat database siswa</div>
        </div>
      </a>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <a href="{{ url_for('admin.teacher_list') }}" class="action-card">
        <div class="action-card-icon">
          <i class="fas fa-chalkboard-teacher"></i>
        </div>
        <div class="action-card-content">
          <div class="action-card-title">Pengajar</div>
          <div class="action-card-desc">Kelola guru & skill</div>
        </div>
      </a>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <a href="{{ url_for('admin.program_manage') }}" class="action-card">
        <div class="action-card-icon">
          <i class="fas fa-book-open"></i>
        </div>
        <div class="action-card-content">
          <div class="action-card-title">Program</div>
          <div class="action-card-desc">Kurikulum & Sesi</div>
        </div>
      </a>
    </div>
  </div>

  <!-- Featured Card & Chart -->
  <div class="row g-4">
    <div class="col-md-6 col-lg-5">
      <a href="{{ url_for('admin.master_schedule') }}" class="featured-card" style="display: block; height: 100%;">
        <div class="featured-card-content">
          <div class="featured-card-label">Monitoring</div>
          <h3 class="fw-700 text-white mb-2">Master Schedule</h3>
          <p class="featured-card-subtitle">Monitoring kepadatan kelas secara real-time.</p>
          <div class="featured-card-badge">
            <i class="fas fa-arrow-right me-1"></i> Lihat Jadwal
          </div>
        </div>
      </a>
    </div>
    <div class="col-md-6 col-lg-7">
      <div class="chart-container" style="height: 100%;">
        <div class="chart-header">
          <h6 class="chart-title">Grafik Pendaftaran Siswa</h6>
        </div>
        <div class="chart-placeholder" id="chartEnrollment">
          <i class="fas fa-chart-bar me-2"></i> Chart akan ditampilkan di sini
        </div>
      </div>
    </div>
  </div>

  {% elif current_user.role == 'teacher' %}
  <!-- ==================== TEACHER DASHBOARD ==================== -->

  <!-- Greeting Section -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="fw-700 mb-1">Selamat Mengajar, {{ current_user.name }}! ðŸ‘‹</h2>
      <p class="text-muted mb-0">Jangan lupa untuk mengisi absensi hari ini.</p>
    </div>
  </div>

  <!-- Quick Actions for Teacher -->
  <div class="row g-4 mb-4">
    <div class="col-md-6">
      <a href="{{ url_for('attendance.view_form', timeslot_id=1) }}" class="action-card"
        style="border-left: 4px solid var(--warning);">
        <div class="action-card-icon" style="background: var(--warning-light); color: var(--warning);">
          <i class="fas fa-sun"></i>
        </div>
        <div class="action-card-content">
          <div class="action-card-title">Absensi Sesi 1</div>
          <div class="action-card-desc">Jam 10:00 - 13:00</div>
        </div>
        <i class="fas fa-chevron-right text-muted"></i>
      </a>
    </div>
    <div class="col-md-6">
      <a href="{{ url_for('attendance.view_form', timeslot_id=2) }}" class="action-card"
        style="border-left: 4px solid var(--sidebar-bg);">
        <div class="action-card-icon" style="background: rgba(30, 58, 95, 0.1); color: var(--sidebar-bg);">
          <i class="fas fa-moon"></i>
        </div>
        <div class="action-card-content">
          <div class="action-card-title">Absensi Sesi 2</div>
          <div class="action-card-desc">Jam 14:00 - 17:00</div>
        </div>
        <i class="fas fa-chevron-right text-muted"></i>
      </a>
    </div>
  </div>

  <!-- Chart Placeholder -->
  <div class="row">
    <div class="col-12">
      <div class="chart-container">
        <div class="chart-header">
          <h6 class="chart-title">Statistik Mengajar Bulan Ini</h6>
        </div>
        <div class="chart-placeholder">
          <i class="fas fa-chart-line me-2"></i> Chart akan ditampilkan di sini
        </div>
      </div>
    </div>
  </div>

  {% elif enrollment %}
  <!-- ==================== STUDENT DASHBOARD ==================== -->

  <!-- Greeting Section -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="fw-700 mb-1">Halo, {{ current_user.name }}! ðŸ‘‹</h2>
      <p class="text-muted mb-0">Selamat belajar di Fashion School.</p>
    </div>
  </div>

  <!-- Stats Section - Student -->
  <div class="row g-4 mb-4">
    <!-- Featured Card - Sessions Remaining -->
    <div class="col-md-4">
      <div class="featured-card" style="height: 100%;">
        <div class="featured-card-content text-center">
          <div class="featured-card-label">Sisa Sesi Anda</div>
          <div class="featured-card-value">{{ enrollment.sessions_remaining }}</div>
          <div class="featured-card-subtitle">{{ enrollment.program.name }}</div>
          {% if enrollment.batch %}
          <div class="featured-card-badge">{{ enrollment.batch.name }}</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Info Cards -->
    <div class="col-md-8">
      <div class="card h-100">
        <div class="card-header">
          <h6 class="card-title mb-0">
            <i class="fas fa-calendar-week text-brand me-2"></i> Jadwal Rutin
          </h6>
          {% if not enrollment.schedules %}
          <a href="{{ url_for('onboarding.schedule_wizard') }}" class="btn btn-primary btn-sm">
            <i class="fas fa-plus me-1"></i> Atur Jadwal
          </a>
          {% endif %}
        </div>
        <div class="card-body p-0">
          {% if enrollment.schedules %}
          <div class="table-responsive">
            <table class="table-modern">
              <thead>
                <tr>
                  <th style="padding-left: 24px;">Hari</th>
                  <th>Waktu</th>
                  <th>Materi</th>
                  <th>Pengajar</th>
                </tr>
              </thead>
              <tbody>
                {% for sched in enrollment.schedules %}
                <tr>
                  <td style="padding-left: 24px;">
                    <span class="badge badge-secondary">{{ days[sched.day_of_week] }}</span>
                  </td>
                  <td class="fw-600 text-brand">{{ sched.timeslot.name }}</td>
                  <td>{{ sched.subject.name }}</td>
                  <td>
                    <div class="d-flex align-items-center gap-2">
                      <div class="avatar avatar-sm">
                        {{ sched.teacher.name[0]|upper }}
                      </div>
                      {{ sched.teacher.name }}
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-5">
            <i class="fas fa-calendar-times fa-3x text-muted mb-3" style="opacity: 0.3;"></i>
            <p class="text-muted">Anda belum memiliki jadwal rutin.</p>
            <a href="{{ url_for('onboarding.schedule_wizard') }}" class="btn btn-primary">
              <i class="fas fa-plus me-1"></i> Atur Jadwal Sekarang
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Progress Chart -->
  <div class="row">
    <div class="col-12">
      <div class="chart-container">
        <div class="chart-header">
          <h6 class="chart-title">Progress Belajar</h6>
        </div>
        <div class="chart-placeholder">
          <i class="fas fa-chart-pie me-2"></i> Chart akan ditampilkan di sini
        </div>
      </div>
    </div>
  </div>

  {% else %}
  <!-- ==================== NO ENROLLMENT ==================== -->
  <div class="row">
    <div class="col-12">
      <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Akun ini terdaftar sebagai Siswa tetapi belum memiliki data Enrollment. Hubungi Admin untuk mendaftarkan
          program.</span>
      </div>
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Chart initialization placeholder
  // TODO: Replace with actual data from backend
  document.addEventListener('DOMContentLoaded', function () {
    const chartEl = document.getElementById('chartEnrollment');
    if (chartEl && typeof Chart !== 'undefined') {
      // Chart will be initialized here when data is available
      console.log('Chart.js loaded and ready');
    }
  });
</script>
{% endblock %}