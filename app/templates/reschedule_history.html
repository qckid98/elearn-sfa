{% extends "base.html" %}

{% block page_title %}Riwayat Reschedule{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="fw-700 mb-1">Riwayat Reschedule</h4>
        <p class="text-muted mb-0">Permintaan pindah jadwal Anda</p>
    </div>
    <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-1"></i> Kembali
    </a>
</div>

<div class="card">
    <div class="card-body p-0">
        {% if requests %}
        <div class="table-responsive">
            <table class="table table-modern mb-0">
                <thead>
                    <tr>
                        <th>Kelas</th>
                        <th>Jadwal Lama</th>
                        <th>Jadwal Baru</th>
                        <th>Status</th>
                        <th>Tanggal Request</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in requests %}
                    <tr>
                        <td>
                            {% if req.class_enrollment and req.class_enrollment.program_class %}
                            <span class="badge bg-primary">{{ req.class_enrollment.program_class.display_name }}</span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="fw-600">{{ days[req.original_date.weekday()] }}, {{
                                req.original_date.strftime('%d %b %Y') }}</div>
                            <small class="text-muted">{{ req.original_timeslot.name if req.original_timeslot else '-'
                                }}</small>
                        </td>
                        <td>
                            <div class="fw-600 text-brand">{{ days[req.new_date.weekday()] }}, {{
                                req.new_date.strftime('%d %b %Y') }}</div>
                            <small class="text-muted">
                                {{ req.new_timeslot.name if req.new_timeslot else '-' }} â€¢
                                {{ req.new_teacher.name if req.new_teacher else '-' }}
                            </small>
                        </td>
                        <td>
                            {% if req.status == 'pending' %}
                            <span class="badge bg-warning text-dark"><i class="fas fa-clock me-1"></i>Menunggu</span>
                            {% elif req.status == 'approved' %}
                            <span class="badge bg-success"><i class="fas fa-check me-1"></i>Disetujui</span>
                            {% else %}
                            <span class="badge bg-danger"><i class="fas fa-times me-1"></i>Ditolak</span>
                            {% if req.rejection_reason %}
                            <br><small class="text-danger">{{ req.rejection_reason }}</small>
                            {% endif %}
                            {% endif %}
                        </td>
                        <td>
                            <small class="text-muted">{{ req.request_date.strftime('%d %b %Y %H:%M') }}</small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-calendar-check text-muted fa-3x mb-3" style="opacity: 0.3;"></i>
            <p class="text-muted mb-0">Belum ada riwayat reschedule</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}