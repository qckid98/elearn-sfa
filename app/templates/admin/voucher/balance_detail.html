{% extends 'base.html' %}

{% block title %}Balance {{ vendor.name }} - Admin{% endblock %}
{% block page_title %}Balance: {{ vendor.name }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <a href="{{ url_for('admin_voucher.vendor_balance') }}" class="btn btn-sm btn-outline-secondary mb-3">
            <i class="fas fa-arrow-left me-1"></i>Kembali
        </a>
        <h5 class="fw-600 mb-0">
            <i class="fas fa-store text-brand me-2"></i>{{ vendor.name }}
        </h5>
    </div>
</div>

<!-- Summary -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="stats-card">
            <div class="stats-card-value text-success">Rp {{ "{:,.0f}".format(total_claimed) }}</div>
            <div class="stats-card-label">Total Claimed</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stats-card">
            <div class="stats-card-value text-primary">Rp {{ "{:,.0f}".format(total_paid) }}</div>
            <div class="stats-card-label">Total Dibayar</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stats-card {{ 'bg-danger' if outstanding > 0 else 'bg-success' }}">
            <div class="stats-card-value text-white">Rp {{ "{:,.0f}".format(outstanding) }}</div>
            <div class="stats-card-label">Outstanding</div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Claimed Vouchers -->
    <div class="col-lg-7">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">
                    <i class="fas fa-ticket-alt me-2"></i>Voucher yang Di-claim
                </h6>
                <span class="badge badge-secondary">{{ claimed_vouchers|length }} voucher</span>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table-modern">
                        <thead>
                            <tr>
                                <th style="padding-left: 16px;">Kode</th>
                                <th>Siswa</th>
                                <th>Nilai</th>
                                <th>Tanggal Claim</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for v in claimed_vouchers %}
                            <tr>
                                <td style="padding-left: 16px;">
                                    <code style="font-size: 11px;">{{ v.code }}</code>
                                </td>
                                <td>{{ v.student.name }}</td>
                                <td class="text-success">Rp {{ "{:,.0f}".format(v.voucher_type.value) }}</td>
                                <td style="font-size: 12px;">{{ v.claimed_at.strftime('%d/%m/%Y') }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center py-3 text-muted">Belum ada voucher di-claim</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Payments -->
    <div class="col-lg-5">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">
                    <i class="fas fa-money-bill me-2"></i>Riwayat Pembayaran
                </h6>
                <a href="{{ url_for('admin_voucher.payment_add', vendor_id=vendor.id) }}"
                    class="btn btn-sm btn-success">
                    <i class="fas fa-plus me-1"></i>Bayar
                </a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table-modern">
                        <thead>
                            <tr>
                                <th style="padding-left: 16px;">Tanggal</th>
                                <th>Jumlah</th>
                                <th>Metode</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in payments %}
                            <tr>
                                <td style="padding-left: 16px;">{{ p.payment_date.strftime('%d/%m/%Y') }}</td>
                                <td class="text-primary fw-600">Rp {{ "{:,.0f}".format(p.amount) }}</td>
                                <td>{{ p.payment_method or '-' }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" class="text-center py-3 text-muted">Belum ada pembayaran</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}