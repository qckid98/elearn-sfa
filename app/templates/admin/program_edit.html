{% extends "base.html" %}

{% block page_title %}Edit Program{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <!-- Breadcrumb -->
    <div class="d-flex align-items-center gap-3 mb-4">
      <a href="{{ url_for('admin.program_manage') }}" class="btn btn-secondary btn-icon"
        style="width: 40px; height: 40px;">
        <i class="fas fa-arrow-left"></i>
      </a>
      <div>
        <h4 class="fw-700 mb-1">Edit Program</h4>
        <p class="text-muted mb-0" style="font-size: 13px;">{{ program.name }}</p>
      </div>
    </div>

    <!-- Edit Form Card -->
    <div class="card" style="border-top: 4px solid var(--warning);">
      <div class="card-body p-4">
        <form method="POST">
          <!-- Program Name -->
          <div class="form-group">
            <label class="form-label">Nama Program</label>
            <input type="text" name="name" class="form-control" value="{{ program.name }}" required />
          </div>

          <!-- Total Sessions -->
          <div class="form-group">
            <label class="form-label">Total Sesi</label>
            <input type="number" name="total_sessions" class="form-control" value="{{ program.total_sessions }}"
              required />
            <div class="form-hint">Jumlah pertemuan dalam program ini</div>
          </div>

          <!-- Batch Toggle -->
          <div class="form-group">
            <label class="d-flex align-items-center gap-3 p-3 rounded"
              style="background: var(--bg-body); cursor: pointer;">
              <input class="form-check-input" type="checkbox" name="is_batch_based" style="width: 20px; height: 20px;"
                {% if program.is_batch_based %}checked{% endif %} />
              <div>
                <div class="fw-600">Sistem Batch</div>
                <div class="text-muted" style="font-size: 12px;">Fast Track dengan jadwal tetap</div>
              </div>
            </label>
          </div>

          <!-- Subject Selection -->
          <div class="form-group">
            <label class="form-label">Pilih Materi</label>
            <div class="p-3 rounded" style="background: var(--bg-body); max-height: 250px; overflow-y: auto;">
              {% for sub in subjects %}
              <label class="d-flex align-items-center gap-2 mb-2 p-2 rounded"
                style="cursor: pointer; transition: background 0.2s;">
                <input class="form-check-input" type="checkbox" name="subjects" value="{{ sub.id }}"
                  style="width: 18px; height: 18px;" {% if sub.id in current_sub_ids %}checked{% endif %} />
                <span>{{ sub.name }}</span>
              </label>
              {% else %}
              <p class="text-muted mb-0" style="font-size: 13px;">Tidak ada materi tersedia</p>
              {% endfor %}
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex gap-2">
            <a href="{{ url_for('admin.program_manage') }}" class="btn btn-secondary flex-fill">
              <i class="fas fa-times me-2"></i> Batal
            </a>
            <button type="submit" class="btn btn-primary flex-fill">
              <i class="fas fa-save me-2"></i> Simpan Perubahan
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% if program.is_batch_based %}
<!-- Batch Management Section -->
<div class="row justify-content-center mt-4">
  <div class="col-md-8 col-lg-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-600">Daftar Batch</h5>
        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addBatchModal">
          <i class="fas fa-plus me-1"></i> Tambah Batch
        </button>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table-modern">
            <thead>
              <tr>
                <th class="ps-4">Nama Batch</th>
                <th class="text-center">Kuota</th>
                <th class="text-center">Status</th>
                <th class="text-end pe-4">Aksi</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in program.batches %}
              <tr>
                <td class="ps-4 fw-600">{{ batch.name }}</td>
                <td class="text-center">{{ batch.max_students }} Siswa</td>
                <td class="text-center">
                  {% if batch.is_active %}
                  <span class="badge badge-success">Aktif</span>
                  {% else %}
                  <span class="badge badge-secondary">Non-Aktif</span>
                  {% endif %}
                </td>
                <td class="text-end pe-4">
                  <button class="btn btn-sm btn-outline btn-icon" data-bs-toggle="modal"
                    data-bs-target="#editBatchModal{{ batch.id }}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <div class="mb-3">
                    <label class="form-label">Nama Batch</label>
                    <input type="text" name="name" class="form-control" value="{{ batch.name }}" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Kuota Maksimal</label>
                    <input type="number" name="max_students" class="form-control" value="{{ batch.max_students }}"
                      required>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="is_active" id="isActive{{ batch.id }}" {% if
                      batch.is_active %}checked{% endif %}>
                    <label class="form-check-label" for="isActive{{ batch.id }}">
                      Batch Aktif (Buka Pendaftaran)
                    </label>
                  </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="submit" class="btn btn-primary">Simpan</button>
        </div>
        </form>
      </div>
    </div>
  </div>
  {% else %}
  <tr>
    <td colspan="4" class="text-center py-4 text-muted">Belum ada batch yang dibuat.</td>
  </tr>
  {% endfor %}
  </tbody>
  </table>
</div>
</div>
</div>
</div>

<!-- Add Batch Modal -->
<div class="modal fade" id="addBatchModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Tambah Batch Baru</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form action="{{ url_for('admin.add_batch') }}" method="POST">
        <input type="hidden" name="program_id" value="{{ program.id }}">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Nama Batch</label>
            <input type="text" name="name" class="form-control" placeholder="Contoh: Batch 1" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Kuota Maksimal</label>
            <input type="number" name="max_students" class="form-control" value="6" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="submit" class="btn btn-primary">Tambah Batch</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

<style>
  .form-group label.d-flex:hover {
    background: var(--border-color) !important;
  }
</style>
{% endblock %}